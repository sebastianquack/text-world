<head>
  <title>Text World</title>
  <script src="jailed-0.2.0/jailed.js"></script>
  <script src="coffee-script.js"></script>
</head>

<body>
  
  {{#if overviewDisplay}}
    {{> roomOverview}}
    {{> newRoomForm}}
  {{/if}}

  {{#if editorDisplay}}
    {{> roomEditor}}
  {{/if}}

  {{#if playDisplay}}
    {{> play}}    
  {{/if}}
</body>

<template name="roomOverview">
    <h2>places overview</h2>
    {{#each rooms}}
      {{> roomDetails}}
    {{/each}}
</template>

<template name="roomDetails">
  <div class="room-details" data-id="{{_id}}">
    <div class="room-options">
      <h3>{{name}}</h3>
      <input class="start-play-button" type="button" value="play from here" name="play-room">
      <input class="open-form-button" type="button" value="edit and test" name="edit-room">
    </div>
  </div>
</template>

<template name="newRoomForm">
    <h4>create a new place</h4>
    <form class="new-room">
      <input type="text" name="name" placeholder="name">
      <input type="submit" value="create">
    </form> 
</template>

<template name="roomEditor">
    <div class="room-edit-form">
      <h2>editing {{currentRoom.name}}</h2>
      <p>edit the JavaScript code below to determine how your place interacts with a player [<label>use <a href="http://coffeescript.org/" target="_blank">CoffeeScript</a></label>
      <input type="checkbox" {{coffeeScriptChecked}} name="use-coffee-script" class="use-coffee-script">]</p>
      <textarea class="room-script" name="roomScript">{{currentRoom.script}}</textarea>
      <ul class="log test-log"></ul>
      <form class="test-form">
        <input class="test-input" id="command-input" type="text" name="testInput" placeholder="type here to test">
      </form>
      <input class="re-enter-room-button" type="button" value="re-enter place">
      <input class="close-edit-button" type="button" value="back to overview">
      <input class="save-script-button" {{saved}} type="button" value="save changes">
      <input class="remove-room-button" type="button" value="delete place">
    </div>
    
    <p class="api-cheat-sheet">place API cheat sheet - these objects and functions are available in every place</p>
    <div class="api-cheat-sheet-code">
// outputting text
output("foo")

// processing player input
input.raw // the raw input that the player entered
input.words[0] // input split up into array of words
input.raw.similar("cool", 20) // check if input is 20% similar to "cool"
input.raw.in(["hi", "hello", "howdy"]) // check if input is equal to any of these words
"thing".in(input.words) // check if any of the words are "thing"

// moving to another place
player.moveTo("park") // moves the player out of this place and to the park

// variables valid for this player in all place
player.health // read
player.set("health", 100) // write

// variables valid for all players in this place
place.doorOpen // read
place.set("doorOpen", true) // write

// variables valid for this player in this place
player.justArrived // use this to check if player just arrived and didn't input anything yet
player.here.discoveredSecret // read
player.setHere("discoveredSecret", true) // write

// reading variables set for a player in other place
player.arrivedFrom // the last room the player visited before this one
player.was["park"] // this will be set if player ever was in park
player.was["park"]["sawBird"] // read variables set for this player in other places
    </div>
    
</template>

<template name="play">
  <div class="play-area">
    <h2>play area</h2>
    <ul class="log play-log"></ul>
    <form class="play-form">
      <input id="command-input" class="play-input" type="text" name="playInput" placeholder="type here to play">
    </form>
    <input class="cancel-play-button" type="button" value="back to room overview">
  </div>
</template>

